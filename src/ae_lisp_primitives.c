#include "ae_lisp_primitives.h"
#include "ae_obj_list.h"

#define DIE assert(0)

////////////////////////////////////////////////////////////////////////////////////////////////////
// _car
////////////////////////////////////////////////////////////////////////////////////////////////////

ae_obj_t *ae_lisp_car(ae_obj_t * const args) {
  ASSERT_CONSP(args);
  ASSERT_NILP(CDR(args));  // takes only one arg.
  ASSERT_TAILP(CAR(args)); // which must be a tail.

  if (NILP(CAR(args)))     // car of nil is nil.
    return NIL;
  
  return CAAR(args);
}

////////////////////////////////////////////////////////////////////////////////////////////////////
// _cdr
////////////////////////////////////////////////////////////////////////////////////////////////////

ae_obj_t *ae_lisp_cdr(ae_obj_t * const args) {
  ASSERT_CONSP(args);
  ASSERT_NILP(CDR(args));  // takes only one arg.
  ASSERT_TAILP(CAR(args)); // which must be a tail.
  
  if (NILP(CAR(args)))     // cdr of nil is nil.
    return NIL;

  return CDAR(args); 
}

////////////////////////////////////////////////////////////////////////////////////////////////////
// _cons
////////////////////////////////////////////////////////////////////////////////////////////////////

ae_obj_t *ae_lisp_cons(ae_obj_t * const args) {
  ASSERT_CONSP(args);
  ASSERT_TAILP(CDR(args)); // 2nd arg must be a tail.
  ASSERT_NILP(CDDR(args)); // only 2 args.

  ae_obj_t * head = CAR(args);
  ae_obj_t * tail = CADR(args);
  
  return CONS(head, tail);
}

////////////////////////////////////////////////////////////////////////////////////////////////////
// _eq
////////////////////////////////////////////////////////////////////////////////////////////////////

ae_obj_t *ae_lisp_eq(ae_obj_t * const args) {
  ASSERT_CONSP(args);
  ASSERT_NOT_NILP(CDR(args));
  ASSERT_NILP(CDDR(args)); // only supports exactly 2 args for now.

  return ae_obj_truth(EQ(CAR(args), CADR(args)));
}

////////////////////////////////////////////////////////////////////////////////////////////////////
// _equal
////////////////////////////////////////////////////////////////////////////////////////////////////

ae_obj_t *ae_lisp_equal(ae_obj_t * const args) {
  ASSERT_CONSP(args);
  ASSERT_NOT_NILP(CDR(args));
  ASSERT_NILP(CDDR(args)); // only supports exactly 2 args for now.

  return ae_obj_truth(ae_obj_equal(CAR(args), CADR(args)));
}
