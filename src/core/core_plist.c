#include "core_includes.h"

////////////////////////////////////////////////////////////////////////////////////////////////////
// _premoveb
////////////////////////////////////////////////////////////////////////////////////////////////////

DEF_CORE_FUN(premoveb) {
  ae_obj_t * const plist = CAR(args);
  ae_obj_t * const key   = CADR(args);

  REQUIRE(CONSP(plist), "PLIST must be a non-empty list");

  PREMOVE_MUTATING(plist, key);

  ret = plist;
  
  END_DEF_CORE_FUN;
}

////////////////////////////////////////////////////////////////////////////////////////////////////
// _premove
////////////////////////////////////////////////////////////////////////////////////////////////////

DEF_CORE_FUN(premove) {
  ae_obj_t * const plist = CAR(args);
  ae_obj_t * const key   = CADR(args);

  REQUIRE(TAILP(plist), "PLIST must be a list");

  ret = PREMOVE_NONMUTATING(plist, key);

  END_DEF_CORE_FUN;
}

////////////////////////////////////////////////////////////////////////////////////////////////////
// _psetb
////////////////////////////////////////////////////////////////////////////////////////////////////

DEF_CORE_FUN(psetb) {
  ae_obj_t * const plist = CAR(args);
  ae_obj_t * const key   = CADR(args);
  ae_obj_t * const value = CADDR(args); // this could be unsave if value is NIL, maybe.

  REQUIRE(CONSP(plist), "PLIST must be a non-empty list");

  PSET_MUTATING(plist, key, value);

  ret = plist;
  
  END_DEF_CORE_FUN;
}

////////////////////////////////////////////////////////////////////////////////////////////////////
// _pset
////////////////////////////////////////////////////////////////////////////////////////////////////

DEF_CORE_FUN(pset) {
  ae_obj_t * const plist = CAR(args);
  ae_obj_t * const key   = CADR(args);
  ae_obj_t * const value = CADDR(args); // this could be unsave if value is NIL, maybe.

  REQUIRE(TAILP(plist), "PLIST must be a list");

  ret = PSET_NONMUTATING(plist, key, value);

  END_DEF_CORE_FUN;
}

////////////////////////////////////////////////////////////////////////////////////////////////////
// _pget
////////////////////////////////////////////////////////////////////////////////////////////////////

DEF_CORE_FUN(pget) {
  ae_obj_t * const plist = CAR(args);
  ae_obj_t * const key   = CADR(args);

  REQUIRE(TAILP(plist), "PLIST must be a list");

  ret = PGET(plist, key);
  
  END_DEF_CORE_FUN;
}

////////////////////////////////////////////////////////////////////////////////////////////////////
// _phas
////////////////////////////////////////////////////////////////////////////////////////////////////

DEF_CORE_FUN(phas) {
  ae_obj_t * const plist = CAR(args);
  ae_obj_t * const key   = CADR(args);

  REQUIRE(TAILP(plist), "PLIST must be a list");

  ret = TRUTH(PHAS(plist, key));
  
  END_DEF_CORE_FUN;
}

